{% extends "../base.html" %}

{% block title %}Build #{{ build.id }} - {{ repo_name }} - Procurator CI{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="/">Home</a>
    <span class="separator">/</span>
    <a href="/{{ username }}">{{ username }}</a>
    <span class="separator">/</span>
    <a href="/{{ username }}/{{ repo_name }}">{{ repo_name }}</a>
    <span class="separator">/</span>
    <span>Build #{{ build.id }}</span>
</div>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
    <h1>{{ username }}/{{ repo_name }}</h1>
    <div class="code-block" style="padding: 8px 12px; font-size: 0.8rem;">
        {{ git_url }}
    </div>
</div>

<div class="tabs">
    <a href="/{{ username }}/{{ repo_name }}" class="tab {% if active_tab == "builds" %}active{% endif %}">
        ğŸ”¨ Builds
    </a>
    <a href="/{{ username }}/{{ repo_name }}/files" class="tab {% if active_tab == "files" %}active{% endif %}">
        ğŸ“ Files
    </a>
    <a href="/{{ username }}/{{ repo_name }}/flake" class="tab {% if active_tab == "flake" %}active{% endif %}">
        â„ï¸ Flake
    </a>
    <a href="/{{ username }}/{{ repo_name }}/infrastructure" class="tab {% if active_tab == "infrastructure" %}active{% endif %}">
        ğŸ—ï¸ Infrastructure
    </a>
</div>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
    <h2>Build #{{ build.id }}</h2>
    {% if build.status.as_str() == "success" %}
    <span class="badge badge-success">{{ build.status }}</span>
    {% else if build.status.as_str() == "failed" %}
    <span class="badge badge-error">{{ build.status }}</span>
    {% else if build.status.as_str() == "running" %}
    <span class="badge badge-warning">{{ build.status }}</span>
    {% else %}
    <span class="badge badge-info">{{ build.status }}</span>
    {% endif %}
</div>

<div class="grid grid-2" style="margin-bottom: 24px;">
    <div class="card">
        <h3 class="card-title">Build Info</h3>
        <div class="meta-info" style="flex-direction: column; gap: 8px; margin-top: 12px;">
            <div class="meta-item">
                <strong style="min-width: 100px;">Commit:</strong>
                <code>{{ build.commit_hash }}</code>
            </div>
            <div class="meta-item">
                <strong style="min-width: 100px;">Branch:</strong>
                <span>{{ build.branch }}</span>
            </div>
            <div class="meta-item">
                <strong style="min-width: 100px;">Created:</strong>
                <span>{{ build.created_at }}</span>
            </div>
            {% if let Some(started) = build.started_at %}
            <div class="meta-item">
                <strong style="min-width: 100px;">Started:</strong>
                <span>{{ started }}</span>
            </div>
            {% endif %}
            {% if let Some(finished) = build.finished_at %}
            <div class="meta-item">
                <strong style="min-width: 100px;">Finished:</strong>
                <span>{{ finished }}</span>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="card">
        <h3 class="card-title">Statistics</h3>
        <div class="meta-info" style="flex-direction: column; gap: 8px; margin-top: 12px;">
            {% if let Some(duration) = build.duration_seconds %}
            <div class="meta-item">
                <strong style="min-width: 100px;">Duration:</strong>
                <span>{{ duration }} seconds</span>
            </div>
            {% endif %}
            <div class="meta-item">
                <strong style="min-width: 100px;">Retries:</strong>
                <span>{{ build.retry_count }} / {{ build.max_retries }}</span>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <h3 class="card-title" style="margin-bottom: 16px;">Build Logs</h3>
    <div class="log-output">{% if let Some(logs) = logs %}{{ logs }}{% else %}No logs available{% endif %}</div>
</div>

<div style="margin-top: 16px;">
    <a href="/{{ username }}/{{ repo_name }}" class="btn">â† Back to Builds</a>
</div>
{% endblock content %}
